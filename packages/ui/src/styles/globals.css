@import "tailwindcss";
@import "tw-animate-css";

@source "../components";

@custom-variant dark (&:is(.dark *));

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-destructive: var(--destructive);
  --color-destructive-foreground: var(--destructive-foreground);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);
  --color-chart-1: var(--chart-1);
  --color-chart-2: var(--chart-2);
  --color-chart-3: var(--chart-3);
  --color-chart-4: var(--chart-4);
  --color-chart-5: var(--chart-5);
  --color-sidebar: var(--sidebar);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-ring: var(--sidebar-ring);
  --color-diff-addition: var(--diff-addition);
  --color-diff-addition-foreground: var(--diff-addition-foreground);
  --color-diff-deletion: var(--diff-deletion);
  --color-diff-deletion-foreground: var(--diff-deletion-foreground);
  --font-sans: "Inter", "Inter Variable", ui-sans-serif, system-ui, sans-serif;
  --font-mono: "IBM Plex Mono", ui-monospace, "SFMono-Regular", monospace;
  --text-xs: 0.8125rem;
  --text-xs--line-height: 1.125rem;
  --text-sm: 0.9375rem;
  --text-sm--line-height: 1.375rem;
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
}

/*
 * Default color palette: 1:1 clone of OpenCode's OC-1 theme.
 * Uses the "smoke" warm gray scale (slight red/brown tint).
 *
 * Light: warm near-whites (#fdfcfc) with dark text (#211e1e)
 * Dark:  warm near-blacks (#131010) with light text (#efeded)
 *
 * OpenCode's dark mode uses alpha-based colors (e.g. smoke-dark-alpha-11).
 * Below are opaque approximations pre-computed against the #131010 background.
 *
 * Mapping from OpenCode tokens:
 *   --background  ← --background-base (#f8f7f7 light / --smoke-dark-1 dark)
 *   --foreground  ← --text-strong (--smoke-light-12 / --smoke-dark-alpha-12)
 *   --card        ← --background-strong (--smoke-light-1 / --smoke-dark-2)
 *   --muted       ← --background-weak (--smoke-light-3 / --smoke-dark-3)
 *   --accent      ← --surface-weak (--smoke-light-4 / --smoke-dark-4)
 *   --border      ← --border-base (--smoke-light-6 / --smoke-dark-alpha-7)
 *   --ring        ← --border-active (--smoke-light-8 / --smoke-dark-alpha-8)
 *   --destructive ← --ember-light-9 (#fc533a, same in both modes)
 *
 * These values serve as the baseline for the theme system.
 * Named themes override these via dynamic <style> injection.
 */

:root {
  --radius: 0.625rem;

  /* Light mode — derived from OpenCode "smoke-light" scale */
  --background: #f8f7f7;
  --foreground: #211e1e;
  --card: #fdfcfc;
  --card-foreground: #211e1e;
  --popover: #fdfcfc;
  --popover-foreground: #211e1e;
  --primary: #211e1e;
  --primary-foreground: #fdfcfc;
  --secondary: #f1f0f0;
  --secondary-foreground: #211e1e;
  --muted: #f1f0f0;
  --muted-foreground: #8e8b8b;
  --accent: #eae8e8;
  --accent-foreground: #211e1e;
  --destructive: #fc533a;
  --destructive-foreground: #fdfcfc;
  --border: #dcd9d9;
  --input: #dcd9d9;
  --ring: #b0aeae;
  --chart-1: #dc6b40;
  --chart-2: #3ba58b;
  --chart-3: #3a6ee0;
  --chart-4: #d4b93c;
  --chart-5: #c75dbd;
  --sidebar: #f1f0f0;
  --sidebar-foreground: #211e1e;
  --sidebar-primary: #211e1e;
  --sidebar-primary-foreground: #fdfcfc;
  --sidebar-accent: #eae8e8;
  --sidebar-accent-foreground: #211e1e;
  --sidebar-border: #e5e3e3;
  --sidebar-ring: #b0aeae;

  /* Diff colors — warm-tinted to match the palette */
  --diff-addition: #2a9d5c;
  --diff-addition-foreground: #1a7a42;
  --diff-deletion: #d94a3a;
  --diff-deletion-foreground: #b83a2e;
}

.dark {
  /* Dark mode — derived from OpenCode "smoke-dark" scale
   * Opaque equivalents of their alpha colors computed on #131010 bg */
  --background: #131010;
  --foreground: #efeded;
  --card: #151313;
  --card-foreground: #efeded;
  --popover: #1c1717;
  --popover-foreground: #efeded;
  --primary: #f1ecec;
  --primary-foreground: #131010;
  --secondary: #1c1717;
  --secondary-foreground: #efeded;
  --muted: #221d1d;
  --muted-foreground: #6f6c6b;
  --accent: #271f1f;
  --accent-foreground: #efeded;
  --destructive: #fc533a;
  --destructive-foreground: #fdfcfc;
  --border: #2d2626;
  --input: #2d2626;
  --ring: #4a4242;
  --chart-1: #e88a5e;
  --chart-2: #4cc9a5;
  --chart-3: #6b98e8;
  --chart-4: #e8d570;
  --chart-5: #d880cf;
  --sidebar: #0f0d0d;
  --sidebar-foreground: #efeded;
  --sidebar-primary: #f1ecec;
  --sidebar-primary-foreground: #131010;
  --sidebar-accent: #1c1717;
  --sidebar-accent-foreground: #efeded;
  --sidebar-border: #251f1f;
  --sidebar-ring: #4a4242;

  /* Diff colors — warm-tinted to match the palette */
  --diff-addition: #4cc9a5;
  --diff-addition-foreground: #5ecc71;
  --diff-deletion: #e8655c;
  --diff-deletion-foreground: #ff6762;
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }
  body {
    @apply bg-background text-foreground;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
    font-feature-settings: "ss03" 1, "rlig" 1, "calt" 1;
  }
  code, kbd, samp, pre {
    font-feature-settings: "ss01" 1;
  }
}

/* @pierre/diffs — override diff highlight colors with theme palette */
@layer base {
  :root {
    --diffs-addition-color-override: var(--diff-addition);
    --diffs-deletion-color-override: var(--diff-deletion);
    --diffs-bg-addition-override: color-mix(in srgb, var(--diff-addition) 10%, var(--background));
    --diffs-bg-addition-number-override: color-mix(in srgb, var(--diff-addition) 14%, var(--background));
    --diffs-bg-addition-hover-override: color-mix(in srgb, var(--diff-addition) 18%, var(--background));
    --diffs-bg-addition-emphasis-override: color-mix(in srgb, var(--diff-addition) 20%, transparent);
    --diffs-bg-deletion-override: color-mix(in srgb, var(--diff-deletion) 10%, var(--background));
    --diffs-bg-deletion-number-override: color-mix(in srgb, var(--diff-deletion) 14%, var(--background));
    --diffs-bg-deletion-hover-override: color-mix(in srgb, var(--diff-deletion) 18%, var(--background));
    --diffs-bg-deletion-emphasis-override: color-mix(in srgb, var(--diff-deletion) 20%, transparent);
  }
}

/* Thin scrollbar — matches shadcn/ui ScrollArea appearance */
@layer base {
  .scrollbar-thin {
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
  }
  .scrollbar-thin::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }
  .scrollbar-thin::-webkit-scrollbar-track {
    background: transparent;
  }
  .scrollbar-thin::-webkit-scrollbar-thumb {
    background-color: var(--border);
    border-radius: 9999px;
    border: 2px solid transparent;
    background-clip: content-box;
  }
  .scrollbar-thin::-webkit-scrollbar-thumb:hover {
    background-color: var(--ring);
  }
}
